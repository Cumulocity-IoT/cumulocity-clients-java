<HTML>
<BODY>
Cumulocity SDK - Java Generic MQTT Client library provides the classes necessary to interact with the Cumulocity Generic
MQTT Broker.

<p>The Cumulocity SDK Java Generic MQTT Client library provides means to the following operations:
<ul>
    <li>Publishing messages to Cumulocity Generic MQTT Broker via WebSocket protocol</li>
    <li>Subscribing to messages from Cumulocity Generic MQTT Broker via WebSocket protocol</li>
</ul>
<p>
    Example usage for publishing messages to Generic MQTT Broker via WebSocket:

<pre>

        // Message to be sent
        final String payload = "Hello World";

        // Construct a new GenericMqttMessage and set the payload
        final GenericMqttMessage genericMqttMessage = new GenericMqttMessage();
        genericMqttMessage.setPayload(message.getBytes());

        // Build GenericMqttConnectionConfig with topic to which the message is to be sent
        final GenericMqttConnectionConfig mqttConnectionConfig =
        GenericMqttConnectionConfig.builder().topic(topic).build();

        // Create an instance of GenericMqttWebSocketFactory by specifying the server URI to connect to along with TokenApi
        final GenericMqttFactory genericMqttFactory = new GenericMqttWebSocketFactory(webSocketBaseUrl, tokenApi);

        // Build GenericMqttPublisher and publish GenericMqttMessage. Close the resource either with usage as below or
        by calling genericMqttPublisher.close()
        try (final GenericMqttPublisher genericMqttPublisher = genericMqttFactory.buildPublisher(mqttConnectionConfig))
        {
            genericMqttPublisher.publish(genericMqttMessage);
        } catch (Exception e) {
            log.error("Could not sent message to {}", topic, e);
        }

    </pre>

<p>
    Example usage for subscribing to messages from Generic MQTT Broker via WebSocket:

<pre>

        // Build GenericMqttConnectionConfig with topic
        final GenericMqttConnectionConfig mqttConnectionConfig = GenericMqttConnectionConfig.builder().topic(topic).build();

        // Create an instance of GenericMqttWebSocketFactory by specifying the server URI to connect to along with TokenApi
        final GenericMqttFactory genericMqttFactory = new GenericMqttWebSocketFactory(properties.getWebSocketURL(), tokenApi);

        // Build GenericMqttSubscriber
        final GenericMqttSubscriber genericMqttSubscriber = genericMqttFactory.buildSubscriber(mqttConnectionConfig);

        // Subscribe by passing implementation of GenericMqttMessageListener to handle events from the websocket server.
        genericMqttSubscriber.subscribe(new GenericMqttMessageListener() {
                &#64;Override
                public void onOpen(URI serverUri) {
                    log.debug("Connected to &lt;{}&gt;", serverUri);
                }

                &#64;Override
                public void onMessage(GenericMqttMessage genericMqttMessage) {
                    log.info("Message Received: {}", new String(genericMqttMessage.getPayload()));
                }

                &#64;Override
                public void onError(Throwable t) {
                    log.error("WebSocket Error", t);
                }

                &#64;Override
                public void onClose(int code, String reason, boolean remote) {
                    log.debug("WebSocket closed " + (remote ? "by server. " : "") + " Code:" + code + ", reason: " + reason);
                }
        });

        // Close the resource after usage
        genericMqttSubscriber.close();

    </pre>


</BODY>
</HTML>